---
title: "初webフルスタックアプリ作って月額サービス狙ったけどやめた話"
emoji: "⛳"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [react, vite, サブスク, stripe, フルスタック]
published: false
---

# はじめに

昔会社をやめて、1 年間ぐらい旅行していた時に YouTube をやっていた時期がありました（なんでや）
その当時、商品価格を他通貨に換算して一つ一つ画像を作っていました。
その当時も、恐らく今も、色々サービスを探しても無かったので便利なアプリ作ってみようというのがきっかけです。

また一応フロントエンドとバックエンドやデータベースなどの一連の流れをこの開発で経験できると踏んだからです。

https://currency-converter-board.com/

# どんなアプリなのか？

![ss1](/images/service-web/ss1.png)

こんな感じで、シンプルな通貨換算された結果を元に画像やウィジェットを作成できるものです。

![ss2](/images/service-web/ss2.png)

![ss3](/images/service-web/ss3.png)

主な機能としては：

- Wise API を使ったリアルタイム為替レート取得（数多くの通貨対応）
- ドラッグ&ドロップで通貨の並び順をカスタマイズ
- 背景色やテキスト色などのカスタマイズ
- PNG 画像としてエクスポート
- iframe 埋め込みコード生成

## 使用した技術スタック

:::details 技術スタック

### フロントエンド

- **React 19** + **Vite 6**
- **TailwindCSS 4** + **DaisyUI 5**: スタイリング
- **@dnd-kit**: ドラッグ&ドロップ機能
- **Canvas API**: PNG 画像エクスポート
- **react-syntax-highlighter**: 埋め込みコードのシンタックスハイライト表示

### バックエンド

- **FastAPI** (Python)
- **PostgreSQL**: ユーザー情報や使用履歴の保存
- **Alembic**: データベースマイグレーション
- **Google OAuth 2.0** + **JWT**: 認証機能

### その他

- **Wise API**: 為替レート取得
- **Stripe**: 決済機能（実装済みだが現在は無料モデル）
- **Vercel**: フロントエンドデプロイ
- **Railway**: バックエンド・データベースデプロイ

:::

:::details アーキテクチャ図

```mermaid
graph TB
    subgraph "フロントエンド (Vercel)"
        A[React 19 + Vite 6]
        B[TailwindCSS 4 + DaisyUI 5]
        C[@dnd-kit]
        D[Canvas API]
        E[i18next]
        RSH[react-syntax-highlighter]
        A --> B
        A --> C
        A --> D
        A --> E
        A --> RSH
    end

    subgraph "バックエンド (Railway)"
        F[FastAPI Python]
        G[Google OAuth 2.0 + JWT]
        H[Alembic]
        F --> G
        F --> H
    end

    subgraph "データベース (Railway)"
        I[(PostgreSQL)]
        J[Users Table]
        K[Usage History Table]
        I --> J
        I --> K
    end

    subgraph "外部API"
        L[Wise API<br/>為替レート取得]
        M[Stripe<br/>決済機能]
        N[Google OAuth<br/>認証]
    end

    A -->|API Request| F
    F -->|認証| G
    G -->|認証| N
    F -->|データ保存/取得| I
    F -->|為替レート取得| L
    F -->|決済処理| M
    D -->|PNG Export| A
    C -->|ドラッグ&ドロップ| A
```

:::

# せっかくだから月額サービス化してみたけども辞めた

作っている時は、月額 3 とか 5 ドルぐらいと無料バージョンでいいかなぁ。とか考えてましたが辞めました。

なんでか？

- 初サービスだし、まずはユーザーがどれくらい来てくれるのか実験したかった
- 画像生成はフロントエンドでやってるので、知恵を働かせれば簡単にダウンロードできる笑
- 法律周り（特定商品取引法）などについて知識が無いので少しビビった（準備するのに時間かかりそうだから一旦無料で最初は出すことに決めました）
- 有料サービスと無料サービスのボーダーを何処にするべきか迷った

これらの点から有料化はやめました。
※Stripe の統合自体は実装済みなので、将来的に有料化する場合は比較的簡単に切り替えるようには残してます。

# 開発の流れ

このアプリの構成ともう少し噛み砕いた内容を備忘録的に書いておきます。

::: warning
恐らくある web に対してご経験のある方には普通のことをだと思いますので、読み飛ばしてしまってください。
:::

## バックエンド：通貨データの取得と処理

Wise はめちゃくちゃ日頃使用してるんですが、wise って api 基本無料で提供してるんですよね。
なので今回は[こちら](https://wise.com/ja/help/articles/2958106/wise-api%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6)を為替レートと通貨の種類の取得に使わせて頂きました。

バックエンドは FastAPI で実装しており、主に以下の 4 つの機能を提供しています。

まず最初に、Wise API を使って為替レートのデータを取得します。この工程では以下の処理を行います：

### 1. 通貨リストと為替レートの取得

Wise API の `/v1/rates` エンドポイントを使用して、リアルタイムの為替レートを取得します。API トークンは[WiseAPI](https://wise.com/jp/business/api)ようにアカウントを作成して簡単に取得できました。
サンドボックスも提供があるので、試しに覗いてみるのもありです。

### 2. 換算レート計算とデータ整形

取得した為替レートを元に、各通貨への換算額を計算し、フロントエンド向けにフォーマットします。
通貨コードを取得して、[Flag Icons](https://github.com/lipis/flag-icons)と微妙に違うコードなどは一時的なスクリプトで確認しながらリネームしてます。

### 3. Google OAuth 認証

Google OAuth 2.0 を使ってユーザー認証を行い、JWT トークンを発行します。
react モジュールは[React OAuth2 | Google](https://www.npmjs.com/package/@react-oauth/google)
ドキュメントどうりにフロントエンドはそのまま実装し、情報やトークンなどはバックエンドと後にやりとりする感じです。

### 4. ユーザー管理とデータベース連携

PostgreSQL を使ってユーザー情報と使用履歴を管理してます。
ユーザー用のテーブルと、現在は使用してませんが、カウントを記録するテーブルも作りました。
※プラン別でエクスポート制限を設けようとしていた為。

::: ユーザー用のテーブルはシンプルにこんな感じです

- ユーザー
- ID
- メール
- 名前
- プラン

:::

現在は全ての機能が無料で無制限に利用可能ですが、Stripe 統合は実装済みなので、将来的に有料化する際はすぐに切り替え可能な設計になっています。

## フロントエンド：取得データの UI 表示

基本的に daisyUI を使って構成し、特に大きく変更したものはありません。
あとは canvas でパラメーターを渡して計算して描画するといったシンプルなものです。

#### 通貨換算ボードの表示

- グリッド形式で複数の通貨を一覧表示 **dnd-kit を使用**
- 各通貨カードには、国旗アイコン、通貨コード、シンボル、換算額を canvas へ渡して描画

#### 入力フォームの実装

- 通貨セレクター：基準となる通貨を選択（検索機能付きドロップダウン）... wise っぽくしてみました
- 時刻選択機能：過去の特定時刻のレートを取得できる履歴機能
- 入力値のデバウンス処理で、ラグらないようにしてます
- 通貨などは最初に受け取っておいて、基準通過が変わらなければ取得したもの再利用

#### ドラッグ&ドロップによる並び替え

- `@dnd-kit` ライブラリを使って、通貨カードをドラッグ&ドロップで自由に並び替え
- モーダルウィンドウで、グリッド形式のドラッグ可能な通貨一覧を表示

## エクスポート：画像生成と埋め込みコード

最後に、完成したボードを画像として保存したり、Web サイトに埋め込むためのコードを生成します。

#### Canvas による PNG 画像エクスポート

- Canvas API の `toDataURL("image/png")` を使用して PNG 画像を直接生成
- 指定したサイズ（幅・高さ）で高品質な PNG 画像を生成
- エクスポート前に認証チェックと使用回数の記録
- ダウンロード完了後、任意で寄付モーダルを表示（収益化の試み）

#### iframe 埋め込みコード生成

- ユーザーの設定（通貨リスト、色、レイアウトなど）を URL パラメータとしてエンコード
- 埋め込み専用の URL を生成（例：`/embed?cols=5&width=1920&...`）
- iframe タグの HTML コードを自動生成
- `react-syntax-highlighter` で dracula テーマを使用してコードを見やすく表示
- ワンクリックでクリップボードにコピー可能

#### エクスポート機能の制御

- Google でログインしたユーザーのみエクスポート可能にしてます
- 使用履歴をデータベースに記録（日次カウント）

これらの工程を経て、ユーザーは簡単に通貨換算ボードを作成し、画像として保存したり、自分の Web サイトに埋め込んだりできるようになっています。

# つまづいた所

- **Claude で一気に書き上げて、杜撰な所が見つかってもう一回 Cursor を使って作り直しました**  
  設計をもっと細かくして Cursor に渡しただけです。
  最初から設計をしっかりしておけば良かったと反省。

- **Canvas の描画とグリッド処理した順番の同期が微妙**  
  ドラッグ&ドロップで並び順を変更した後、Canvas に描画する際の順番が正しく反映されない問題がありました。状態管理を見直して解決。

- **useMemo, useEffects などの扱い方をしっかり把握しておきべき**  
  パフォーマンス最適化のために React Hooks の理解が重要だと実感。無駄な再レンダリングを防ぐために useMemo や useCallback を適切に使う必要がありました。(ちなみにまだ無駄が少し残っている....)

- **React DnD がバグるので、一番時間を費やしました**  
   `@dnd-kit` を使いましたが、window の幅などをいじると react 19 ではバグったため、地味に解決方法を見つけるのに時間がかかりました。
  **createPortal**が適切に設定されていないのが原因で 1 時間ぐらいなじゃこりゃってなってました。

# これから

まずはやっぱ勢いで作ってみましたが、どれだけニーズなどがあるのかも微妙ですし探り探りやって行こうと思います。
あと SEO 対策とかそもそもパフォーマンスどうなのかとか。
入力する部分とプレビューが同じスペースで出来ないのが、微妙に操作しづらいのでそこを何とかしたい。
様子見ながら、ちょくちょく手直ししていこうと思います。

# まとめ

フルスタックアプリを一から作る経験ができたのは良かったです。
特にバックエンドとフロントエンドの連携、認証周り、サブスク API の使用など、色々学べました。

また、web での UX/UI をどうするべきかとかもう少し学必要があるなと感じました。
自分で使っていてなんか違うんだよなぁ〜と感じます。。。

もし使ってみたい方がいれば、フィードバックいただけると嬉しいです！

## 出典・参考リンク

- [Wise API](https://wise.com/ja/help/articles/2958106/wise-api%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6) - 為替レート取得に使用
- [Flag Icons](https://github.com/lipis/flag-icons) - 国旗 SVG アイコンのライブラリ
- [通貨換算ボード（本アプリ）](https://currency-converter-board.com/)
- [React](https://react.dev/) - フロントエンドフレームワーク
- [FastAPI](https://fastapi.tiangolo.com/) - バックエンドフレームワーク
- [DaisyUI](https://daisyui.com/) - TailwindCSS コンポーネントライブラリ
- [@dnd-kit](https://dndkit.com/) - ドラッグ&ドロップライブラリ
- [react-syntax-highlighter](https://github.com/react-syntax-highlighter/react-syntax-highlighter) - コードのシンタックスハイライト表示
