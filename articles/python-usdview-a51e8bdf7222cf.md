---
title: "USDã‚’ãƒ“ãƒ«ãƒ‰ã—ã¦ã€Viewerã‚’ã‚«ã‚¹ã‚¿ãƒ ã—ã¦ã¿ã‚‹"
emoji: "ðŸ—‚"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [python, cpp ,USD, viewer, 3d]
published: false
---

# ã¯ã˜ã‚ã«
USD(Universal Scene Description)Viewerã‚’è§¦ã‚‹ã“ã¨ãŒã‚ã£ãŸã®ã§ã€è‰²ã€…ã¾ã¨ã‚ãŸã„ã¨æ€ã„ã¾ã™ã€‚
ä¼šç¤¾ã§USD Viewerã‚’å°Žå…¥ã™ã‚‹ã«ã‚ãŸã£ã¦ã€ã¾ãšã¯æ‰‹å§‹ã‚ã«ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ¼ãƒ³ã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹ã®ã«ä½¿ã£ãŸã‚Šã€‚ã¾ãŸã¯ã€ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¨ã—ã¦çµ„ã¿è¾¼ã‚€ã§ä½¿ãˆã‚‹æ§˜ã«ãªã©ã‚’è¡Œã£ã¦ã„ã¾ã—ãŸã€‚
æœ€åˆã¯è¨³ã‚ã‹ã‚“ãªã£ãŸï¼ˆãƒ“ãƒ«ãƒ‰ï¼‰ã§ã™ã‘ã©ã€åƒ•ã¿ãŸã„ãªã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ã¯ãªã„äººã‚„ã€USDã“ã‚Œã‹ã‚‰è§¦ã‚ã†ã¨ã—ã¦ã„ã‚‹äººã«å‘ã‘ã¦è¨˜éŒ²ã¨ã—ã¦æ®‹ã—ã¦ãŠãã¾ã™ã€‚
ã‚´ãƒ¼ãƒ«ã¨ã—ã¦ã¯ã€ãƒ“ãƒ«ãƒ‰ã—ãŸã‚‚ã®ã‚’ã‚«ã‚¹ã‚¿ãƒ ã—ã¦Viewerã‚’ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã™ã‚‹ã¨ã“ã‚ã¾ã§ã¨ã—ã¾ã™ã€‚

ã¨ã‚Šã‚ãˆãšã€ã‚µãƒ³ãƒ—ãƒ«ã®ãƒ‡ãƒ¼ã‚¿è¦‹ã¦ã¿ãŸã„ã¨ã„ã†æ–¹ã¯ã€ä»¥ä¸‹ãƒ¬ãƒã‚’ã”è¦§ãã ã•ã„ã€‚
https://github.com/testkun08080/custom-embed-usdviewer

#### ä½œæˆã•ã‚Œã‚‹æœ€çµ‚ã‚¤ãƒ¡ãƒ¼ã‚¸
![ã‚¤ãƒ¡ãƒ¼ã‚¸](https://raw.githubusercontent.com/testkun08080/custom-embed-usdviewer/refs/heads/main/docs/sample.gif)

## ã“ã®è¨˜äº‹ã®æµã‚Œ
1. Universal Scene Description (USD) ã¨ã¯ï¼Ÿ
2. ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ“ãƒ«ãƒ‰ã™ã‚‹(python)
3. USD viewerå˜ç‹¬ã§èµ·å‹•ã™ã‚‹
4. USD Viewerã‚’ã‚«ã‚¹ã‚¿ãƒ ã—ã¦ã¿ã‚‹

## Universal Scene Description (USD) ã¨ã¯ï¼Ÿ
ã–ã£ãã‚Šè¨€ãˆã°ã€ã€ã€*è¤‡é›‘ã«ãªã£ãŸ3Dã‚¢ã‚»ãƒƒãƒˆã®ã‚„ã‚Šå–ã‚Šã‚’ã€USDãŒä¸­é–“ã«å…¥ã£ã¦å††æ»‘ã«ã—ã‚ˆã†!*
ã¨ã„ã†è§£é‡ˆã§ã„ã„ã¨æ€ã„ã¾ã™ã€‚ä»¥ä¸‹ã€ŒUSDã¨ã¯ã€ã‚’å…¬å¼ã‹ã‚‰ç¿»è¨³ã—ãŸã‚‚ã®ã€‚

> æ˜ ç”»ã‚„ã‚²ãƒ¼ãƒ ãªã©ã®ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ãƒ¼ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯ã‚¹ã‚’åˆ¶ä½œã™ã‚‹ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã¯ã€å¤§é‡ã®3Dãƒ‡ãƒ¼ã‚¿ï¼ˆã‚·ãƒ¼ãƒ³è¨˜è¿°ï¼‰ã‚’ç”Ÿæˆã€ä¿å­˜ã€é€ä¿¡ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ‡ãƒ¼ã‚¿ã¯ã€ãƒ¢ãƒ‡ãƒªãƒ³ã‚°ã€ã‚·ã‚§ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã€ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã€ãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚°ã€ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã€ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãªã©ã€å„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ç‰¹å®šã®ãƒ‹ãƒ¼ã‚ºã«å¿œã˜ã¦ã‚«ã‚¹ã‚¿ãƒžã‚¤ã‚ºã•ã‚Œã¦ãŠã‚Šã€ä»–ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã¯èª­ã¿è¾¼ã¿ã‚„ç·¨é›†ãŒã§ããªã„ã“ã¨ãŒä¸€èˆ¬çš„ã§ã™ã€‚
> 
> Universal Scene Description (USD) ã¯ã€ã“ã®èª²é¡Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã«åˆã‚ã¦å…¬é–‹ã•ã‚ŒãŸã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã§ã‚ã‚Šã€è¤‡æ•°ã®è¦ç´ ã§æ§‹æˆã•ã‚ŒãŸ3Dã‚·ãƒ¼ãƒ³ã‚’åŠ¹çŽ‡çš„ã‹ã¤ã‚¹ã‚±ãƒ¼ãƒ©ãƒ–ãƒ«ã«å…±æœ‰ã—ã€æ‹¡å¼µã™ã‚‹ãŸã‚ã®å¼·åŠ›ãªãƒ„ãƒ¼ãƒ«ã§ã™ã€‚
> 
> USDã¯ãƒ¢ãƒ‡ãƒ«ã‚„ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãªã©ã®è¦ç´ è³‡ç”£ã‚’äº¤æ›ã™ã‚‹ã ã‘ã§ãªãã€ãã‚Œã‚‰ã‚’ä»®æƒ³ã‚»ãƒƒãƒˆã€ã‚·ãƒ¼ãƒ³ã€ã‚·ãƒ§ãƒƒãƒˆã€ãƒ¯ãƒ¼ãƒ«ãƒ‰ã«ã¾ã¨ã‚ã€å„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–“ã§é€ä¿¡ã—ã€ç ´å£Šçš„ã§ãªã„æ–¹æ³•ã§ç·¨é›†ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚ã•ã‚‰ã«ã€å˜ä¸€ã®APIã¨ã‚·ãƒ¼ãƒ³ã‚°ãƒ©ãƒ•ã‚’ä½¿ç”¨ã—ã¦ã€3Dã‚¸ã‚ªãƒ¡ãƒˆãƒªã€ã‚·ã‚§ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã€ãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚°ã€ç‰©ç†ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãªã©ã€ã•ã¾ã–ã¾ãªã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯é–¢é€£ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è¿…é€Ÿã«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ãŸã‚Šç·¨é›†ã—ãŸã‚Šã™ã‚‹ãŸã‚ã®è±Šå¯Œãªãƒ„ãƒ¼ãƒ«ã‚»ãƒƒãƒˆã‚’æä¾›ã—ã¾ã™ã€‚
> 
> ç‰¹ã«ã€USDã®ã‚³ã‚¢ã§ã‚ã‚‹ã‚·ãƒ¼ãƒ³ã‚°ãƒ©ãƒ•ã¨ã‚³ãƒ³ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚¨ãƒ³ã‚¸ãƒ³ã¯ã€ç‰¹å®šã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã«ä¾å­˜ã—ãªã„è¨­è¨ˆã¨ãªã£ã¦ãŠã‚Šã€ä»–ã®ãƒ‡ãƒ¼ã‚¿ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’æŒç¶šå¯èƒ½ãªå½¢ã§æ‹¡å¼µã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚
> 
> USDã¯ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚ã‚Šã€TOSTãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®ã‚‚ã¨ã§æä¾›ã•ã‚Œã¦ã„ã¾ã™ã€‚[^1]

[^1]:USDã¨ã¯(https://openusd.org/release/intro.html#what-is-usd)

## é–‹ç™ºç’°å¢ƒ
- macOS Sequoia 15.5
- VsCode
- zsh 5.9 (arm64-apple-darwin24.0)

## ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ“ãƒ«ãƒ‰ã—ã¦ã¿ã‚‹

- ã¾ãšã¯ãƒ­ãƒ¼ã‚«ãƒ«ã¸ã‚¯ãƒ­ãƒ¼ãƒ³ã¾ãŸã¯ã‚µãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’è¡Œã„ã¾ã™
  ã‚µãƒ–ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ä½¿ã†å ´åˆ
    ```zsh
    git submodule add https://github.com/PixarAnimationStudios/OpenUSD OpenUSD         
    ```
    or

  ã‚¯ãƒ­ãƒ¼ãƒ³
    ```zsh
    git clone https://github.com/PixarAnimationStudios/OpenUSD.git        
    ```

- UVã‚’ä½¿ç”¨ã—ã¦VENVã®ä½œæˆã—ã€ãƒ“ãƒ«ãƒ‰é–‹å§‹
  ã‚ˆãå…¬å¼ã®[ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://github.com/PixarAnimationStudios/OpenUSD.git)ã‚’ã”è¦§ã«ãªã£ã¦ã€ãƒ“ãƒ«ãƒ‰ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
  ```zsh
  uv init -p 3.11
  uv add PyOpenGL PySide6 numpy
  uv run OpenUSD/build_scripts/build_usd.py BuildUSD
  ```
  ãƒ“ãƒ«ãƒ‰ãŒæ­£ã—ãçµ‚ã‚ã‚Œã°ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ­ã‚°ãŒè¦‹ã‚Œã‚‹ã¯ãšã§ã™ã€‚
  ```zdh
  Success! To use USD, please ensure that you have:

    The following in your PYTHONPATH environment variable:
    /Users/Username/path/custom-embed-usdviewer/BuildUSD/lib/python

    The following in your PATH environment variable:
    /Users/Username/path/custom-embed-usdviewer/BuildUSD/bin
  ```

- ç’°å¢ƒãƒ‘ã‚¹ã®è¨­å®š
  
  PYTHONPATHã®è¨­å®š
    ```zsh
    cat > .env <<EOL
    PYTHONPATH=./BuildUSD/lib/python
    EOL
    ```
  
  PATHã®è¨­å®š
    ```zsh
    export PATH=./BuildUSD/bin:$PATH
    ```


## USD viewerå˜ç‹¬ã§èµ·å‹•ã™ã‚‹
ä»¥ä¸‹ã‚³ãƒžãƒ³ãƒ‰ã§ã€USDViewerãŒç«‹ã¡ä¸ŠãŒã‚‹ã¯ãšã§ã™ã€‚(åˆå›žã¯èµ·å‹•ã«æ™‚é–“ãŒã‹ã‹ã‚‹ã¯ãšã§ã™)
- uvã§usdviewã‚’ç›´æŽ¥èµ·å‹•
  ```zsh
  uv run --env-file=.env usdview OpenUSD/extras/usd/tutorials/convertingLayerFormats/Sphere.usda
  ```

PythonçµŒç”±ã§èµ·å‹•ã™ã‚‹å ´åˆ
- pythonãƒ•ã‚¡ã‚¤ãƒ«çµŒç”±ã§èµ·å‹•
  - ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
    ```zsh
    cat > open_usd_viewer.py <<EOL
    """This script is a simple USD viewer using the pxr.Usdviewq module."""
    import sys
    import pxr.Usdviewq as Usdviewq
    
    if __name__ == "__main__":
        # Let Ctrl-C kill the app.
        import signal

        signal.signal(signal.SIGINT, signal.SIG_DFL)

        try:
            usd_path = "assets/Sphere.usda"
            sys.argv.append(usd_path)
            Usdviewq.Launcher().Run()
        except Usdviewq.InvalidUsdviewOption as e:
            print("ERROR: " + str(e), file=sys.stderr)
            sys.exit(1)
    EOL
    ```

  - ä½œæˆå¾Œã€èµ·å‹•
    ```zsh
    uv run open_usd_viewer.py
    ```

## USD Viewerã‚’ã‚«ã‚¹ã‚¿ãƒ ã—ã¦ã¿ã‚‹

### usdviewerã‚’åŸ‹ã‚è¾¼ã‚“ã widgetã‚’ä½œæˆ
ã¾ãšã¯ã€usdviewerã‚’åŸ‹ã‚è¾¼ã‚“ã widgetã‚’ä½œæˆã—ã¾ã™ã€‚
ã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã„ãŸã ã‘ã‚Œã°ã‚ã‹ã‚‹ã¨æ€ã„ã¾ã™ãŒã€`from pxr.Usdviewq.stageView import StageView`ãŒé‡è¦ãªã¨ã“ã‚ã‹ã¨æ€ã„ã¾ã™ã€‚
ã‚ã¨ãƒ©ãƒƒãƒ‘ãƒ¼é–¢æ•°ã‚’ä½œã£ã¦ãŠã„ã¦ã€å¾Œã«è¨˜è¿°ã™ã‚‹UIå´ã§æ“ä½œã™ã‚‹æ„Ÿã˜ã§ã™ã€‚
**ä»¥ä¸‹ã‚³ãƒžãƒ³ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã§ãã¾ã™**

:::details embed_usd_widget.py
```python
cat > embed_usd_widget.py <<EOL
"""A simple application to embed a USD viewer using PySide6."""

import os
import sys
from datetime import datetime
from PySide6 import QtCore, QtWidgets
from pxr import Usd, UsdUtils
from pxr.Usdviewq.stageView import StageView, RenderModes


class EmmbedUSDWidget(QtWidgets.QWidget):
    """A widget to embed USD stage viewer."""

    def __init__(self, stage=None):
        super(EmmbedUSDWidget, self).__init__()
        self.model = StageView.DefaultDataModel()
        self.stage = stage
        self.view = StageView(dataModel=self.model)

        layout = QtWidgets.QVBoxLayout(self)
        layout.addWidget(self.view)
        layout.setContentsMargins(0, 0, 0, 0)

        if self.stage:
            self.set_stage(self.stage)

        # Reset View
        self.view.updateView(resetCam=True, forceComputeBBox=True)

    def image_save(self):
        """Save the current view as an image file."""
        print("GetRendererAovs", self.view.GetRendererAovs())
        image = self.view.grabFramebuffer()
        timestamp = datetime.now().strftime("%Y-%m-%d_%H%M%S")
        os.makedirs("screenshots", exist_ok=True)
        filename = f"screenshots/screenshot_{timestamp}.png"
        image.save(filename)

    def set_stage(self, stage):
        """Set the USD stage for the viewer

        Args:
            stage (QGLWidget): USD stage to set in the viewer.

        """
        self.model.stage = stage

    def set_render_mode(self, mode):
        """Set the render mode for the viewer.

        Args:
            mode (str): The render mode to set.
        """
        if mode in RenderModes:
            self.model.viewSettings.renderMode = mode
        else:
            print(f"Invalid render mode: {mode}")

    def reset_camera(self):
        """Resets the camera to fit the geometry in the view."""
        self.view.updateView(resetCam=True, forceComputeBBox=True)

    def show_hud(self, enable=True):
        """Show the HUD (Heads-Up Display) in the viewer.

        Args:
            enable (bool, optional): A value will handle HUD . Defaults to True.
        """

        self.model.viewSettings.showHUD = enable

    def show_bboxes(self, enable=True):
        """Show bounding boxes in the viewer.

        Args:
            enable (bool, optional): A value will handle bounding boxes. Defaults to True.
        """

        self.model.viewSettings.showBBoxes = enable

    def closeEvent(self, event):
        """Close envet handler to ensure proper cleanup.

        Args:
            event (QtGui.QCloseEvent): The close event triggered by the widget.
        """

        # Ensure to close the renderer to avoid GlfPostPendingGLErrors
        self.view.closeRenderer()

if __name__ == "__main__":
    app = QtWidgets.QApplication([])

    import signal

    signal.signal(signal.SIGINT, signal.SIG_DFL)

    path = "assets/Sphere.usda"

    with Usd.StageCacheContext(UsdUtils.StageCache.Get()):
        stage = Usd.Stage.Open(path)

    window = EmmbedUSDWidget(stage)
    window.setWindowTitle("USD Viewer")
    window.resize(QtCore.QSize(750, 750))
    window.show()

    sys.exit(app.exec_())
EOL
```
:::

### ä½œã£ãŸwidgetã‚’ä½¿ã£ã¦ã‚«ã‚¹ã‚¿ãƒ viewerã‚’ä½œã‚‹
ã‚«ã‚¹ã‚¿ãƒ ã¨ã„ã£ã¦ã‚‚ã€ãƒ‰ãƒƒã‚­ãƒ³ã‚°å¯èƒ½ãªwidgetã‹ã‚‰ã€viewerã®UIã‚’ãƒ©ãƒƒãƒ—ãƒ¼é–¢æ•°ã‚’ä½¿ã£ã¦æ“ä½œã™ã‚‹ç°¡å˜ãªwindowã‚’ä½œã‚Šã¾ã™ã€‚
æ§‹é€ ã¨ã—ã¦ã¯ã€å¤§ã¾ã‹ãªUIãƒ•ã‚¡ã‚¤ãƒ«ã§ä½œæˆã—ã¦ãŠã„ã¦ã€åŸ‹ã‚è¾¼ã¿widgetã‚’ä½¿ã£ã¦ã„ã‚‹ã ã‘ã§ã™ã€‚

#### UIãƒ•ã‚¡ã‚¤ãƒ«
ä»¥ä¸‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã®ã‚ˆã†ã«QTCreatorãªã©ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚
![ã‚¤ãƒ¡ãƒ¼ã‚¸](/images/python-usdview-a51e8bdf7222cf/ss-a.png)
uiãƒ•ã‚¡ã‚¤ãƒ«ã®è©³ç´°ã¯gitå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã”ç¢ºèªãã ã•ã„ã€‚
https://github.com/testkun08080/custom-embed-usdviewer/blob/main/UI/usdViewerController.ui

**ä»¥ä¸‹ã‚³ãƒžãƒ³ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦UIãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã§ãã¾ã™**
```zsh
mkdir -p UI && curl -L -o UI/usdViewerController.ui https://raw.githubusercontent.com/testkun08080/custom-embed-usdviewer/main/UI/usdViewerController.ui
```

#### UIãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ã£ã¦åŸ‹ã‚è¾¼ã¿ç”¨usdviewer widgetã‚’æ“ä½œã™ã‚‹

**ä»¥ä¸‹ã‚³ãƒžãƒ³ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã§ãã¾ã™**

:::details app.py
```python
cat > app.py <<EOL
"""Module providing a USD viewer application."""

import sys
from PySide6 import QtWidgets
from PySide6.QtUiTools import QUiLoader
from PySide6.QtCore import QFile, QIODevice
from pxr import Usd, UsdUtils
from pxr.Usdviewq.stageView import RenderModes

from embed_usd_widget import EmmbedUSDWidget


def get_ui_widget(ui_file_name):
    """Loads and returns a UI widget from a UI file.

    Args:
        ui_file_name (str): The path to the UI file to load.

    Returns:
        QWidget: The loaded UI widget.
    """
    ui_file = QFile(ui_file_name)
    if not ui_file.open(QIODevice.ReadOnly):
        print(f"Cannot open {ui_file_name}: {ui_file.errorString()}")
        sys.exit(-1)
    loader = QUiLoader()
    ui_widget = loader.load(ui_file)
    ui_file.close()

    return ui_widget


class EmbedUsdViewerController:
    """Controller class for the Embed USD viewer.

    Manages the loading of USD stages and the viewer widget.
    """

    def __init__(self, usd_file=None):
        """Initializes the USD viewer controller.

        Args:
            usd_file (str): USD file
        """

        self.ui = get_ui_widget("UI/usdViewerController.ui")

        # Load USD Stage
        with Usd.StageCacheContext(UsdUtils.StageCache.Get()):
            self.stage = Usd.Stage.Open(usd_file)

        # Embed USD Viewer widget
        self.usd_widget = EmmbedUSDWidget(self.stage)
        self.ui.main_layout.addWidget(self.usd_widget)

        # Connect Save Image button event
        self.ui.save_image_button.clicked.connect(self.usd_widget.image_save)

        # Connect Reset Camera button event
        self.ui.reset_camera_button.clicked.connect(self.usd_widget.reset_camera)

        # Connect Render Mode comboBox event
        self.ui.shading_mode_combobox.addItems([mode for mode in RenderModes])
        self.ui.shading_mode_combobox.setCurrentText(self.usd_widget.model.viewSettings.renderMode)
        self.ui.shading_mode_combobox.currentTextChanged.connect(self.usd_widget.set_render_mode)

        # Connect HUB checkBox event
        self.ui.show_hud_checkbox.setChecked(self.usd_widget.model.viewSettings.showHUD)
        self.ui.show_hud_checkbox.clicked.connect(self.usd_widget.show_hud)

        # Connect BBoxes checkBox event
        self.ui.show_bbxs_checkbox.setChecked(self.usd_widget.model.viewSettings.showBBoxes)
        self.ui.show_bbxs_checkbox.clicked.connect(self.usd_widget.show_bboxes)

    def setup_aov_ui(self):
        """Sets up the UI for AOVs selection.

        Retrieves the AOVs list and adds them to a combo box.
        """

        # Retrieve and add AOVs list to combo box
        aovs = self.usd_widget.view.GetRendererAovs()
        if not aovs:
            # Add default AOVs if the list is empty
            default_aovs = ["color", "primId", "depth", "Neye"]
            for aov in default_aovs:
                self.ui.aovs_combobox.addItem(aov)
        else:
            for aov in aovs:
                self.ui.aovs_combobox.addItem(aov)

        # Connect AOV selection event
        self.ui.aovs_combobox.currentTextChanged.connect(self.on_aov_changed)

    def on_aov_changed(self, aov_name):
        """Updates the view based on the selected AOV.

        Args:
            aov_name (str): The name of the selected AOV.
        """

        # Update view to the selected AOV
        if aov_name:
            self.usd_widget.view.SetRendererAov(aov_name)
            self.usd_widget.view.update()


if __name__ == "__main__":
    app = QtWidgets.QApplication(sys.argv)

    viewer_controller = EmbedUsdViewerController("assets/Sphere.usda")
    viewer_controller.ui.show()

    # You might need to call this after shop up the window
    viewer_controller.setup_aov_ui()
    sys.exit(app.exec_())
EOL
```
:::

app.pyã¨uiãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆãŒçµ‚ã‚ã£ãŸã‚‰ã€ä»¥ä¸‹ã‚³ãƒžãƒ³ãƒ‰ã§èµ·å‹•ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
```zsh
uv run app.py
```

ã†ã¾ãã„ã‘ã°ã€ä»¥ä¸‹ã®ã‚ˆã†ãªUIãŒèµ·å‹•ã™ã‚‹ã¯ãšã§ã™ã€‚
![æœ€çµ‚å½¢æ…‹](https://raw.githubusercontent.com/testkun08080/custom-embed-usdviewer/refs/heads/main/docs/sample_image.png)


## ã¾ã¨ã‚ã€æ„Ÿæƒ³
æœ€å¾Œã¾ã§ã”è¦§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚
å„ä¼šç¤¾ã€ç‹¬è‡ªã§ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³ãªã©ã‚’æŒã¤ã¨ã“ã‚ã¯ã€ã“ã‚Œã‚’ä½¿ã£ã¦ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ„ãƒ¼ãƒ«ã¨ã—ã¦å¤–éƒ¨ã¸æ¸¡ã—ãŸã‚Šãªã©ã‚‚å¯èƒ½ã‹ãªã¨è€ƒãˆã¦ã„ã¾ã™ã€‚
(å¤§å¤‰ãã†ã ã‘ã©ã‚‚)
ã„ã„ã­é ‚ã‘ã‚‹ã¨ä¸€æ—¥ãƒãƒƒãƒ”ãƒ¼ã§ã™ã€‚

## å‚è€ƒæ–‡çŒ®
- æ—¥æœ¬èªžã§ã®æƒ…å ±ã¯ã‹ãªã‚Šå°‘ãªãã¦ã€ã“ã¡ã‚‰ã®ãƒšãƒ¼ã‚¸ã¯USDã‚’ç†è§£ã™ã‚‹ã®ã«éžå¸¸ã«å‚è€ƒã«ãªã‚Šã¾ã—ãŸã€‚
  https://fereria.github.io/reincarnation_tech/usd/what_is_usd

- ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ¼ãƒ³ã®usdviewerã‚’widgetã«åŸ‹ã‚è¾¼ã‚“ã§ä½¿ç”¨ã™ã‚‹ã®ã«éžå¸¸ã«åŠ©ã‹ã‚Šã¾ã—ãŸ
  https://gist.github.com/BigRoy/5ac50208969fdc69a722d66874faf8a2#file-usdviewport_qt-py

- å…¬å¼
  https://openusd.org/release/index.html